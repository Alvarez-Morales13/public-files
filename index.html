<!doctype html>
<html lang="es">
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
 <title>Galaxia para ti</title>
 <style>
 html,body{margin:0;height:100%;background:#000;overflow:hidden}
 #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
 .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
 .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
 background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
 backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
 .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff; cursor:pointer}
 .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
 background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
 .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
 </style>
 <script src="https://cdn.jsdelivr.net"></script>
 <script src="https://cdn.jsdelivr.net"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Infinitamente Mi Princesa Hermosaüíú</div>
<div class="attribution">Base: Para Nathy </div>
<div id="err" class="error"></div>
<div class="player">
 <button id="playBtn">Reproducir</button>
 <span style="font-size:12px;opacity:.9">Escuchando: <b>Margaret - Lana Del Reyüíú</b></span>
 <audio id="audio" preload="auto" loop>
 <source src="https://youtu.be/2xtKhqbNBoY?si=sWTnZxCYFTtIKvGj" type="audio/mpeg">
 </audio>
</div>
<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }

// ====== AUDIO ======
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');

playBtn.onclick = async () => {
  try { 
    if (audio.paused) { 
      await audio.play(); 
      playBtn.textContent='Pausar'; 
    } else { 
      audio.pause(); 
      playBtn.textContent='Reproducir'; 
    } 
  } catch(e){ 
    showError('Toca en cualquier parte de la pantalla primero para activar el sonido.'); 
  }
};

// Iniciar audio al primer click en la galaxia
document.addEventListener('click', () => {
    if(audio.paused) {
        audio.play().catch(()=>{});
        playBtn.textContent='Pausar';
    }
}, {once: true});

// ====== WEBGL CHECK ======
try { 
 const test = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
 if(!test) throw new Error('Tu navegador no tiene WebGL activo');
} catch(e) { showError('WebGL parece desactivado.'); return; }

// ====== THREE.JS GALAXY (Original del PDF) ======
try {
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.minDistance = 10; controls.maxDistance = 220;
controls.target.set(0,0,0);

function setCam(){
 const w = window.innerWidth, h = window.innerHeight;
 const isMobile = w < 768 || w < h;
 camera.fov = isMobile ? 90 : 75;
 camera.position.set(0, isMobile? 26 : 22, isMobile? 110 : 75);
 camera.updateProjectionMatrix(); controls.update();
} setCam();

function makePrettyStarTexture(size=1024, count=2000) {
 const c = document.createElement('canvas'); c.width = c.height = size;
 const g = c.getContext('2d');
 const r = size/2;
 const bg = g.createRadialGradient(r,r, r*0.2, r,r, r);
 bg.addColorStop(0,'#050010'); bg.addColorStop(1,'#000000');
 g.fillStyle = bg; g.fillRect(0,0,size,size);
 for (let i=0;i<count;i++) {
  const x = Math.random()*size, y = Math.random()*size;
  const base = Math.random()*0.7 + 0.3;
  const glow = g.createRadialGradient(x,y,0, x,y, Math.random()*2.2+1.6);
  glow.addColorStop(0, 'rgba(255,255,255,'+(0.65*base)+')');
  glow.addColorStop(1, 'rgba(180,190,255,0)');
  g.fillStyle = glow; g.beginPath(); g.arc(x,y, Math.random()*1.2+0.6, 0, Math.PI*2); g.fill();
 }
 return new THREE.CanvasTexture(c);
}

const bgGeo = new THREE.SphereGeometry(600, 64, 64);
const starTex = makePrettyStarTexture(1024, 2600);
starTex.wrapS = starTex.wrapT = THREE.RepeatWrapping;
const bg = new THREE.Mesh(bgGeo, new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide, transparent:false, opacity:0.85 }));
scene.add(bg);

const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Pinchecha", "Hermosa", "Mi Bebe", "Mi Cielito", "Hermosota", "Mi Infinita", "Mi Todo", "Me Encantas", "Nathy", "Te Amo", "Mi Canci√≥n Favorita", "Unica", "Mi Reina", "Mi Amor", "Mi Mundo", "Mi Luz", "Mi Ni√±a", "Mi Tesoro", "Mi Paz", "Mi Eterna", "Mi Sue√±o", "Mi Pensamiento Favorito", "Mi Bombom", "Mi Diosa", "Te Amo Infinitamente"];
const phraseCount = 180;
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text, size=48){
 const c=document.createElement('canvas'); c.width=1024; c.height=128;
 const g=c.getContext('2d');
 g.font='800 '+size+'px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';
 g.textAlign='center'; g.textBaseline='middle';
 g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur=24;
 g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,c.width/2,c.height/2);
 return new THREE.CanvasTexture(c);
}

for(let i=0;i<phraseCount;i++){
 const text = phrases[i%phrases.length];
 const tex=makeTextTexture(text,48);
 const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
 const perArm=phraseCount/arms; const ang=(i%perArm)*(Math.PI*2/perArm);
 const armAng=Math.floor(i/perArm)*(Math.PI*2/arms);
 const dist=Math.pow(i/phraseCount,0.72)*radius;
 const thickness=Math.pow(1-(dist/radius),2);
 const x=Math.cos(ang+armAng)*dist, z=Math.sin(ang+armAng)*dist, y=(Math.random()-0.5)*maxH*thickness*.9;
 spr.position.set(x,y,z); spr.scale.set(20,2.6,1); galaxy.add(spr);
}

const starCount=8000, geom=new THREE.BufferGeometry(), pos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){ 
 const ang=Math.random()*Math.PI*2, dist=Math.random()*radius*1.15;
 const y=(Math.random()-0.5)*36*Math.pow(1-Math.min(dist,radius)/radius,1.5);
 pos[i*3]=Math.cos(ang)*dist; pos[i*3+1]=y; pos[i*3+2]=Math.sin(ang)*dist; 
}
geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
galaxy.add(new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending })));

const coreR=12;
const coreTexCanvas=document.createElement('canvas'); coreTexCanvas.width=coreTexCanvas.height=256;
const cg=coreTexCanvas.getContext('2d'); const grd=cg.createRadialGradient(128,128,10,128,128,128);
grd.addColorStop(0,'#140018'); grd.addColorStop(0.6,'#090012'); grd.addColorStop(1,'#000'); cg.fillStyle=grd; 
cg.arc(128,128,128,0,Math.PI*2); cg.fill();
const core=new THREE.Mesh(new THREE.SphereGeometry(coreR,64,64), new THREE.MeshBasicMaterial({ map:new THREE.CanvasTexture(coreTexCanvas) }));
core.renderOrder=1; scene.add(core);

let tw = 0;
function animate(){
 requestAnimationFrame(animate);
 const t = performance.now()*0.001;
 tw = (tw + 0.0003) % 1;
 starTex.offset.set(tw, 0);
 galaxy.rotation.y = t * 0.05;
 core.rotation.y = t * 0.12;
 controls.update();
 renderer.render(scene, camera);
} animate();

// ====== CORAZONES ======
const fx = document.getElementById('fx');
const ctx2 = fx.getContext('2d');
const hearts = [];
function resizeFx(){ 
  fx.width = innerWidth * (window.devicePixelRatio||1); 
  fx.height = innerHeight * (window.devicePixelRatio||1); 
}
addEventListener('resize', resizeFx); resizeFx();

function spawnHearts(x,y){
 const dpr = window.devicePixelRatio || 1;
 for(let i=0;i<15;i++) hearts.push({x:x*dpr, y:y*dpr, vx:(Math.random()-0.5)*5, vy:(Math.random()-1)*5, life:1, size:10+Math.random()*15});
}

addEventListener('click', (e)=> spawnHearts(e.clientX, e.clientY));

function loopFx(){
 ctx2.clearRect(0,0,fx.width,fx.height);
 for(let i=hearts.length-1;i>=0;i--){
  const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.life-=0.015;
  ctx2.globalAlpha=Math.max(0,h.life);
  ctx2.font = h.size+"px Arial"; ctx2.fillText("‚ù§Ô∏è", h.x, h.y);
  if(h.life<=0) hearts.splice(i,1);
 }
 requestAnimationFrame(loopFx);
} loopFx();

} catch(e) { showError('Error cargando la galaxia: '+e.message); }
})();
</script>
</body>
</html>
