<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Galaxia para tiğŸ’œ</title>
<meta name="description" content="Galaxia">
<meta property="og:title" content="Galaxia para ti">
<meta property="og:description" content="Una galaxia">
<link rel="icon" type="image/png" href="favicon.png">
<style>
html, body{margin:0;height:100%;background: #000;overflow:hidden}
#galaxy-canvas{position:fixed; inset:0;width:100%;height:100%; display:block; touch-action:none}
.attribution{position:fixed; left:10px;bottom:10px;font-size:11px;color:#b9a0ff; opacity:.8; background:rgba(0,0,0,.35); padding:6px 8px; border-radius:8px}
.player{position:fixed; left: 10px; right: 10px;bottom: 10px; display: flex; gap:8px;align-items:center;
background:rgba(20,15,35,.35); border:1px solid rgba(255,255,255,.12); border-radius:12px;padding:8px;
backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial}
.player button{padding:8px 12px;border-radius: 10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08);color:#fff}
.player input[type=file]{display:none}
.pill{position:fixed; top:10px;left:50%; transform: translateX(-50%); padding:6px 12px; border-radius:999px;
background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);color:#fff; font:12px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial; white-space: nowrap;}
.error{position:fixed; inset:auto 10px 70px 10px; background:#260015;color:#ffd9f7; border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;z-index:100;}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Infinitamente Mi Princesa HermosağŸ’œ</div>
<div class="attribution">Base: Para Nathy</div>
<div id="err" class="error"></div>
<div class="player">
<button id="playBtn">â–¶</button>
<span style="font-size:12px;opacity:.9">Margaret <b> - Lana de ReyğŸ’œ</span>
<input type="file" id="pickFile" accept="audio/*">
<button id="pickBtn">Elegir canciÃ³n</button>
<audio id="audio" preload="auto">
<source src="margaret.mp3" type="audio/mpeg">
</audio>
</div>
<canvas id="fx" style="position:fixed; inset:0; pointer-events:none;"></canvas>

<script>
(function(){
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

// FUNCIÃ“N CLAVE: Intenta reproducir al primer toque
function activarAudio() {
    audio.play().then(() => {
        playBtn.textContent = 'â¸';
        // Una vez que suena, quitamos los escuchadores para no interferir mÃ¡s
        window.removeEventListener('click', activarAudio);
        window.removeEventListener('touchstart', activarAudio);
    }).catch(e => console.log("Esperando interacciÃ³n real..."));
}

// Escuchamos en toda la ventana
window.addEventListener('click', activarAudio);
window.addEventListener('touchstart', activarAudio);

playBtn.onclick = () => {
    if (audio.paused) {
        audio.play();
        playBtn.textContent = 'â¸';
    } else {
        audio.pause();
        playBtn.textContent = 'â–¶';
    }
};

pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
    if (pickFile.files && pickFile.files[0]) {
        audio.src = URL.createObjectURL(pickFile.files[0]);
        audio.play().then(() => playBtn.textContent = 'â¸');
    }
};

// --- GALAXY CORE (Fiel al PDF) ---
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// PosiciÃ³n de cÃ¡mara para que se vea bien en mÃ³vil y PC
function resize(){
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}
window.addEventListener('resize', resize);
camera.position.set(0, 25, 100);

// Textura de estrellas de fondo
const starCanvas = document.createElement('canvas');
starCanvas.width = starCanvas.height = 512;
const sCtx = starCanvas.getContext('2d');
const grad = sCtx.createRadialGradient(256,256,10, 256,256,256);
grad.addColorStop(0, '#1a1a2e'); grad.addColorStop(1, '#000000');
sCtx.fillStyle = grad; sCtx.fillRect(0,0,512,512);
const starTex = new THREE.CanvasTexture(starCanvas);
const bg = new THREE.Mesh(new THREE.SphereGeometry(600, 32, 32), new THREE.MeshBasicMaterial({map: starTex, side: THREE.BackSide}));
scene.add(bg);

const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Princesa âœ¨", " Hermosa ğŸ’œ", "Mi Bebe", "Mi Cielito ğŸŒŒ", "Hermosota âœ¨", "Mi Infinita â™¾ï¸", "Mi Todo", "Me Encantas ğŸ¥°", " Nathy ğŸ’«", "Te AmoğŸ’œ", "Mi CanciÃ³n Favorita ğŸ¶", "Unica ğŸ˜Š", "Mi Reina ğŸ‘‘", "Mi Amor", "Mi Mundo", "Mi Luz ğŸŒ ", "Mi NiÃ±a", "Mi TesoroğŸ’œ", "Mi Paz", "Mi Eterna", "Mi SueÃ±o", "Mi Pensamiento Favorito", "Mi Bombom", "Mi Diosa", "Te Amo Infinitamente â™¾ï¸"];

function makeText(txt) {
    const c = document.createElement('canvas'); c.width = 512; c.height = 64;
    const g = c.getContext('2d');
    g.font = 'bold 30px Arial'; g.fillStyle = '#fff'; g.textAlign = 'center';
    g.shadowColor = '#d28cff'; g.shadowBlur = 10;
    g.fillText(txt, 256, 40);
    return new THREE.CanvasTexture(c);
}

for(let i=0; i<150; i++) {
    const tex = makeText(phrases[i % phrases.length]);
    const mat = new THREE.SpriteMaterial({map: tex, transparent: true});
    const spr = new THREE.Sprite(mat);
    const ang = Math.random() * Math.PI * 2;
    const rad = 20 + Math.random() * 80;
    spr.position.set(Math.cos(ang)*rad, (Math.random()-0.5)*15, Math.sin(ang)*rad);
    spr.scale.set(15, 2, 1);
    galaxy.add(spr);
}

function animate() {
    requestAnimationFrame(animate);
    galaxy.rotation.y += 0.002;
    controls.update();
    renderer.render(scene, camera);
}
animate();

// Efecto Corazones
const fx = document.getElementById('fx');
const fctx = fx.getContext('2d');
function resFx() { fx.width = window.innerWidth; fx.height = window.innerHeight; }
resFx(); window.addEventListener('resize', resFx);

const hearts = [];
function spawn(x,y) {
    for(let i=0; i<10; i++) hearts.push({x,y, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, size:Math.random()*15+5, op:1});
}
window.addEventListener('click', (e) => spawn(e.clientX, e.clientY));
window.addEventListener('touchstart', (e) => spawn(e.touches[0].clientX, e.touches[0].clientY));

function drawHearts() {
    fctx.clearRect(0,0,fx.width, fx.height);
    hearts.forEach((h, i) => {
        h.x += h.vx; h.y += h.vy; h.op -= 0.02;
        fctx.globalAlpha = h.op;
        fctx.fillStyle = '#ff5aa0';
        fctx.beginPath(); fctx.arc(h.x, h.y, h.size/2, 0, Math.PI*2); fctx.fill();
        if(h.op <= 0) hearts.splice(i, 1);
    });
    requestAnimationFrame(drawHearts);
}
drawHearts();
})();
</script>
</body>
</html>
