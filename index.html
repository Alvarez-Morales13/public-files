<!doctype html>
<html lang="es">
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
 <title>Galaxia para ti</title>
 <style>
 html,body{margin:0;height:100%;background:#000;overflow:hidden}
 #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
 .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
 .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
 background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
 backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
 .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
 .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
 background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
 .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
 </style>
 <script src="https://cdn.jsdelivr.net"></script>
 <script src="https://cdn.jsdelivr.net"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Infinitamente Mi Princesa Hermosa </div>
<div class="attribution">Base: Para Nathy </div>
<div id="err" class="error"></div>
<div class="player">
 <button id="playBtn">▶</button>
 <span style="font-size:12px;opacity:.9">Escuchando: <b>Margaret - Lana Del Rey</b></span>
 <audio id="audio" preload="auto" loop>
  <source src="margaret.mp3" type="audio/mpeg">
 </audio>
</div>
<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');

playBtn.onclick = async () => {
 try { 
  if (audio.paused) { await audio.play(); playBtn.textContent='⏸'; } 
  else { audio.pause(); playBtn.textContent='▶'; } 
 } catch(e){ showError('Haz clic en la galaxia para activar el sonido.'); }
};

document.addEventListener('click', () => {
    if(audio.paused) {
        audio.play().catch(()=>{});
        playBtn.textContent='⏸';
    }
}, {once: true});

// ====== LÓGICA COMPLETA DE LA GALAXIA ======
try {
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
renderer.setPixelRatio(window.devicePixelRatio || 1);
renderer.setSize(window.innerWidth, window.innerHeight);
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
camera.position.set(0, 22, 75);

// Estrellas de fondo
const starGeo = new THREE.BufferGeometry();
const starPos = new Float32Array(8000 * 3);
for(let i=0; i<8000*3; i++) starPos[i] = (Math.random() - 0.5) * 1000;
starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.5})));

const galaxy = new THREE.Group();
scene.add(galaxy);
const phrases = ["Pinchecha", "Hermosa", "Mi Bebe", "Mi Cielito", "Hermosota", "Te Amo", "Mi Reina", "Mi Amor", "Te Amo Infinitamente"];

function makeText(txt) {
    const c = document.createElement('canvas'); c.width = 512; c.height = 64;
    const g = c.getContext('2d');
    g.font = 'bold 32px Arial'; g.fillStyle = 'white'; g.textAlign = 'center';
    g.fillText(txt, 256, 40);
    return new THREE.CanvasTexture(c);
}

for(let i=0; i<180; i++) {
    const mat = new THREE.SpriteMaterial({ map: makeText(phrases[i % phrases.length]), transparent: true });
    const sp = new THREE.Sprite(mat);
    const ang = i * 0.2; const dist = Math.pow(i/180, 0.72) * 82;
    sp.position.set(Math.cos(ang)*dist, (Math.random()-0.5)*10, Math.sin(ang)*dist);
    sp.scale.set(18, 2.5, 1);
    galaxy.add(sp);
}

function animate(){
    requestAnimationFrame(animate);
    galaxy.rotation.y += 0.002;
    controls.update();
    renderer.render(scene, camera);
} animate();

// Corazones al hacer clic
const fx = document.getElementById('fx');
const ctx = fx.getContext('2d');
const hearts = [];
function resize(){ fx.width = innerWidth; fx.height = innerHeight; }
window.onresize = resize; resize();

addEventListener('click', (e) => {
    for(let i=0; i<10; i++) hearts.push({x:e.clientX, y:e.clientY, vx:(Math.random()-0.5)*4, vy:(Math.random()-1)*4, l:1});
});

function draw(){
    ctx.clearRect(0,0,fx.width,fx.height);
    for(let i=hearts.length-1; i>=0; i--){
        const h = hearts[i]; h.x+=h.vx; h.y+=h.vy; h.l-=0.02;
        ctx.font = "20px Arial"; ctx.globalAlpha = h.l;
        ctx.fillText("❤️", h.x, h.y);
        if(h.l <= 0) hearts.splice(i,1);
    }
    requestAnimationFrame(draw);
} draw();

} catch(e) { showError('Error: ' + e.message); }
})();
</script>
</body>
</html>
