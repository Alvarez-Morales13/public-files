<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Galaxia para tiüíú</title>
<meta name="description" content="Galaxia">
<meta property="og:title" content="Galaxia para ti">
<meta property="og:description" content="Una galaxia">
<meta property="og:image" content="og-cover.png">
<link rel="icon" type="image/png" href="favicon.png">
<style>
html, body{margin:0;height:100%;background: #000;overflow:hidden}
#galaxy-canvas{position:fixed; inset:0;width:100%;height:100%; display:block; touch-action:none}
.attribution{position:fixed; left:10px;bottom:10px;font-size:11px;color:#b9a0ff; opacity:.8; background:rgba(0,0,0,.35); padding:6px 8px; border-radius:8px}
.player{position:fixed; left: 10px; right: 10px;bottom: 10px; display: flex; gap:8px;align-items:center;
background:rgba(20,15,35,.35); border:1px solid rgba(255,255,255,.12); border-radius:12px;padding:8px;
backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial}
.player button{padding:8px 12px;border-radius: 10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08);color:#fff}
.player input[type=file]{display:none}
.pill{position:fixed; top:10px;left:50%; transform: translateX(-50%); padding:6px 12px; border-radius:999px;
background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);color:#fff; font:12px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial}
.error{position:fixed; inset:auto 10px 70px 10px; background:#260015;color:#ffd9f7; border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Infinitamente Mi Princesa Hermosaüíú</div>
<div class="attribution">Base: Para Nathy</div>
<div id="err" class="error"></div>
<div class="player">
<button id="playBtn">‚ñ∂</button>
<span style="font-size:12px;opacity:.9">Margaret <b> - Lana de Rey</span>
<input type="file" id="pickFile" accept="audio/*">
<button id="pickBtn">Elegir canci√≥n</button>
<audio id="audio" preload="auto" loop>
<source src="margaret.mp3" type="audio/mpeg">
</audio>
</div>
<canvas id="fx" style="position:fixed; inset:0; pointer-events:none;"></canvas>
<script>
(function(){
const err = document.getElementById('err');
function showError(msg) { err.textContent = msg; err.style.display='block'; }

const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

// Funci√≥n unificada para reproducir
async function startMusic() {
    try {
        if (audio.paused) {
            await audio.play();
            playBtn.textContent = '‚è∏';
        }
    } catch(e) {
        console.error("Error al reproducir:", e);
    }
}

// Escuchar toques en toda la pantalla para m√≥viles
document.body.addEventListener('touchstart', startMusic, { once: true });
document.body.addEventListener('mousedown', startMusic, { once: true });

playBtn.onclick = async () => {
    if (audio.paused) {
        await audio.play();
        playBtn.textContent = '‚è∏';
    } else {
        audio.pause();
        playBtn.textContent = '‚ñ∂';
    }
};

pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
    if (pickFile.files && pickFile.files[0]) {
        audio.src = URL.createObjectURL(pickFile.files[0]);
        audio.play().then(() => playBtn.textContent = '‚è∏');
    }
};

try {
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.target.set(0,0,0);

function setCam(){
    const w = window.innerWidth, h = window.innerHeight;
    const isMobile = w < 768 || w < h;
    camera.fov = isMobile ? 90 : 75;
    camera.position.set(0, isMobile ? 26 : 22, isMobile ? 110 : 75);
    camera.updateProjectionMatrix(); controls.update();
} setCam();
window.addEventListener('resize', setCam);

function makePrettyStarTexture(size = 1024, count = 2600) {
    const c = document.createElement('canvas'); c.width = c.height = size;
    const g = c.getContext('2d');
    const r = size/2;
    const bg = g.createRadialGradient(r,r, r*0.2, r,r, r);
    bg.addColorStop(0,'#050010'); bg.addColorStop(1,'#000000');
    g.fillStyle = bg; g.fillRect(0,0, size, size);
    for (let i=0; i<count; i++) {
        const x = Math.random()*size, y = Math.random()*size;
        const base = Math.random()*0.7+0.3;
        const glow = g.createRadialGradient(x,y,0, x,y, Math.random()*2.2+1.6);
        const huePick = Math.random();
        let colOuter = 'rgba(180,190,255,'+(0.12*base)+')';
        if (huePick < 0.25) colOuter = 'rgba(255,180,240,'+(0.12*base)+')';
        glow.addColorStop(0, 'rgba(255,255,255,'+(0.65*base)+')');
        glow.addColorStop(1, colOuter);
        g.fillStyle = glow; g.beginPath(); g.arc(x,y, Math.random()*1.2+0.6,0, Math.PI*2); g.fill();
    }
    return new THREE.CanvasTexture(c);
}

const starTex = makePrettyStarTexture();
starTex.wrapS = starTex.wrapT = THREE.RepeatWrapping;
const bg = new THREE.Mesh(new THREE.SphereGeometry(600, 64, 64), new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide }));
scene.add(bg);

const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Princesa ‚ú®", " Hermosa üíú", "Mi Bebe", "Mi Cielito üåå", "Hermosota ‚ú®", "Mi Infinita ‚ôæÔ∏è", "Mi Todo", "Me Encantas ü•∞", " Nathy üí´", "Te Amoüíú", "Mi Canci√≥n Favorita üé∂", "Unica üòä", "Mi Reina üëë", "Mi Amor", "Mi Mundo", "Mi Luz üå†", "Mi Ni√±a", "Mi Tesoroüíú", "Mi Paz", "Mi Eterna", "Mi Sue√±o", "Mi Pensamiento Favorito", "Mi Bombom", "Mi Diosa", "Te Amo Infinitamente ‚ôæÔ∏è"];
const phraseCount = Math.max(phrases.length * 6, 180);
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text) {
    const c = document.createElement('canvas'); c.width = 1024; c.height = 128;
    const g = c.getContext('2d');
    g.font = '800 48px -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial';
    g.textAlign='center'; g.textBaseline='middle';
    g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur = 24;
    g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,512,64);
    return new THREE.CanvasTexture(c);
}

for(let i=0; i<phraseCount; i++){
    const tex = makeTextTexture(phrases[i % phrases.length]);
    const spr = new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
    const perArm = phraseCount/arms;
    const ang = (i % perArm) * (Math.PI*2/perArm);
    const armAng = Math.floor(i/perArm) * (Math.PI*2/arms);
    const dist = Math.pow(i/phraseCount, 0.72) * radius;
    const thickness = Math.pow(1-(dist/radius), 2);
    spr.position.set(Math.cos(ang+armAng)*dist, (Math.random()-0.5)*maxH*thickness*.9, Math.sin(ang+armAng)*dist);
    spr.scale.set(20,2.6,1); galaxy.add(spr);
}

const coreR = 12;
const coreTexCanvas=document.createElement('canvas'); coreTexCanvas.width=coreTexCanvas.height = 256;
const cg=coreTexCanvas.getContext('2d'); const grd=cg.createRadialGradient(128,128,10,128,128,128);
grd.addColorStop(0, '#140018'); grd.addColorStop(0.6,'#090012'); grd.addColorStop(1,'#000');
cg.fillStyle=grd; cg.arc(128,128,128,0, Math.PI*2); cg.fill();
const core=new THREE.Mesh(new THREE.SphereGeometry(coreR,64,64), new THREE.MeshBasicMaterial({ map:new THREE.CanvasTexture(coreTexCanvas) }));
scene.add(core);

const photonRing=new THREE.Mesh(new THREE.RingGeometry(coreR*1.05, coreR*1.18, 128), new THREE.MeshBasicMaterial({ color:0xEAAEFF, transparent:true, opacity:0.95, side: THREE.DoubleSide }));
photonRing.rotation.x=-Math.PI/2; scene.add(photonRing);

let tw=0;
function animate(){
    requestAnimationFrame(animate);
    const t = performance.now()*0.001;
    tw=(tw+0.0003) % 1; starTex.offset.set(tw, 0);
    galaxy.rotation.y = t*0.05; core.rotation.y = t*0.12;
    photonRing.rotation.z = t*0.18;
    controls.update(); renderer.render(scene, camera);
} animate();

// Corazones
const fx = document.getElementById('fx');
const ctx2 = fx.getContext('2d');
function resizeFx(){
    fx.width = innerWidth * (window.devicePixelRatio || 1);
    fx.height = innerHeight * (window.devicePixelRatio || 1);
} resizeFx(); window.addEventListener('resize', resizeFx);

const hearts = [];
function spawnHearts(x,y){
    const DPR = window.devicePixelRatio || 1;
    for(let i=0; i<20; i++){
        const a = Math.random()*Math.PI*2;
        hearts.push({x:x*DPR, y:y*DPR, vx:Math.cos(a)*(Math.random()+0.5), vy:-(Math.random()+1), life:1, size:10+Math.random()*15});
    }
}

function drawHeart(x,y,s){
    ctx2.save(); ctx2.translate(x,y); ctx2.beginPath();
    ctx2.bezierCurveTo(.5*s,-.9*s,1.4*s,-.1*s,0,.9*s);
    ctx2.bezierCurveTo(-1.4*s,-.1*s,-.5*s,-.9*s,0,-.25*s);
    ctx2.fillStyle='rgba(255,90,160,'+ctx2.globalAlpha+')'; ctx2.fill(); ctx2.restore();
}

window.addEventListener('mousedown', (e)=>spawnHearts(e.clientX, e.clientY));
window.addEventListener('touchstart', (e)=>spawnHearts(e.touches[0].clientX, e.touches[0].clientY));

function loopFx(){
    ctx2.clearRect(0,0,fx.width, fx.height);
    for(let i=hearts.length-1; i>=0; i--){
        const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy+=0.02; h.life-=0.015;
        ctx2.globalAlpha=Math.max(0,h.life); drawHeart(h.x,h.y,h.size);
        if(h.life<=0) hearts.splice(i,1);
    }
    requestAnimationFrame(loopFx);
} loopFx();

} catch(e) { showError('Error: '+e.message); }
})();
</script>
</body>
</html>
