<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Galaxia para ti</title>
<meta name="description" content="Galaxia">
<meta property="og:title" content="Galaxia para ti">
<meta property="og:description" content="Una galaxia">
<link rel="icon" type="image/png" href="favicon.png">
<style>
html, body{margin:0;height:100%;background: #000;overflow:hidden}
#galaxy-canvas{position:fixed; inset:0;width:100%;height:100%; display:block; touch-action:none}
.attribution{position:fixed; left:10px;bottom:10px;font-size:11px;color:#b9a0ff; opacity:.8; background:rgba(0,0,0,.35); padding:6px 8px; border-radius:8px}
.player{position:fixed; left: 10px; right: 10px;bottom: 10px; display: flex; gap:8px;align-items:center;
background:rgba(20,15,35,.35); border:1px solid rgba(255,255,255,.12); border-radius:12px;padding:8px;
backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial}
.player button{padding:8px 12px;border-radius: 10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08);color:#fff}
.player input[type=file]{display:none}
.pill{position:fixed; top:10px;left:50%; transform: translateX(-50%); padding:6px 12px; border-radius:999px;
background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);color:#fff; font:12px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial; white-space:nowrap}
.error{position:fixed; inset:auto 10px 70px 10px; background:#260015;color:#ffd9f7; border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Infinitamente Mi Princesa Hermosa</div>
<div class="attribution">Base: Para Nathy</div>
<div id="err" class="error"></div>
<div class="player">
<button id="playBtn">▶</button>
<span style="font-size:12px;opacity:.9">Elije tu cancion <b>cancion.mp3</b>Detalles Mr<b> (Reproductor Mr")</span>
<input type="file" id="pickFile" accept="audio/*">
<button id="pickBtn">Elegir canción</button>
<audio id="audio" preload="auto">
<source src="margaret.mp3" type="audio/mpeg">
</audio>
</div>
<canvas id="fx" style="position:fixed; inset:0; pointer-events:none;"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg) { err.textContent = msg; err.style.display='block'; }

const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

// REPRODUCCIÓN AUTOMÁTICA AL TOCAR
const startMusic = () => {
    audio.play().then(() => {
        playBtn.textContent = '⏸';
        window.removeEventListener('click', startMusic);
        window.removeEventListener('touchstart', startMusic);
    }).catch(() => {});
};
window.addEventListener('click', startMusic);
window.addEventListener('touchstart', startMusic);

playBtn.onclick = () => {
    if (audio.paused) { audio.play(); playBtn.textContent = '⏸'; } 
    else { audio.pause(); playBtn.textContent = '▶'; }
};

pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
    if (pickFile.files && pickFile.files[0]) {
        audio.src = URL.createObjectURL(pickFile.files[0]);
        audio.play().then(() => playBtn.textContent = '⏸');
    }
};

// --- GALAXY ENGINE (IDÉNTICO AL PDF) ---
try {
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.minDistance = 10; controls.maxDistance = 220;

function setCam(){
    const isMobile = window.innerWidth < 768;
    camera.fov = isMobile ? 90 : 75;
    camera.position.set(0, isMobile ? 26 : 22, isMobile ? 110 : 75);
    camera.updateProjectionMatrix(); controls.update();
} setCam(); window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    setCam();
});

function makePrettyStarTexture(size = 1024, count = 2000) {
    const c = document.createElement('canvas'); c.width = c.height = size;
    const g = c.getContext('2d');
    const r = size/2;
    const bg = g.createRadialGradient(r,r, r*0.2, r,r, r);
    bg.addColorStop(0,'#050010'); bg.addColorStop(1,'#000000');
    g.fillStyle = bg; g.fillRect(0,0, size, size);
    for (let i=0; i<count; i++) {
        const x = Math.random()*size, y = Math.random()*size;
        const glow = g.createRadialGradient(x,y,0, x,y, Math.random()*2+1);
        glow.addColorStop(0, 'rgba(255,255,255,0.8)');
        glow.addColorStop(1, 'rgba(0,0,0,0)');
        g.fillStyle = glow; g.beginPath(); g.arc(x,y, 1.5,0, Math.PI*2); g.fill();
    }
    return new THREE.CanvasTexture(c);
}

const starTex = makePrettyStarTexture();
const bg = new THREE.Mesh(new THREE.SphereGeometry(600, 64, 64), new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide }));
scene.add(bg);

const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Pinchecha", " Hermosa", "Mi Bebe", "Mi Cielito", "Hermosota", "Mi Infinita co", "Mi Todo", "Me Encantas", " Nathy", "Te Amo❤", "Mi Canción Favorita", "Unica", "Mi Reina", "Mi Amor", "Mi Mundo", "Mi Luz", "Mi Niña", "Mi Tesoro❤❤", "Mi Paz", "Mi Eterna", "Mi Pensamiento Favorito", "Mi Bombom", "Mi Diosa", "Te Amo Infinitamente", "Mi Sueño"];
const phraseCount = 180;
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text){
    const c = document.createElement('canvas'); c.width = 1024; c.height = 128;
    const g = c.getContext('2d');
    g.font = '800 48px Arial'; g.textAlign='center'; g.textBaseline='middle';
    g.shadowColor='rgba(210,140,255,0.9)'; g.shadowBlur = 15;
    g.fillStyle='#fff'; g.fillText(text,512,64);
    return new THREE.CanvasTexture(c);
}

for(let i=0; i<phraseCount; i++){
    const tex = makeTextTexture(phrases[i % phrases.length]);
    const spr = new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
    const ang = (i % (phraseCount/arms)) * (Math.PI*2/(phraseCount/arms));
    const armAng = Math.floor(i/(phraseCount/arms)) * (Math.PI*2/arms);
    const dist = Math.pow(i/phraseCount, 0.7) * radius;
    spr.position.set(Math.cos(ang+armAng)*dist, (Math.random()-0.5)*maxH*Math.pow(1-dist/radius, 2), Math.sin(ang+armAng)*dist);
    spr.scale.set(20,2.6,1); galaxy.add(spr);
}

// Estrellas de la Galaxia
const starCount = 8000, pos = new Float32Array(starCount*3);
for(let i=0; i<starCount; i++){
    const a = Math.random()*Math.PI*2, d = Math.random()*radius;
    pos[i*3]=Math.cos(a)*d; pos[i*3+1]=(Math.random()-0.5)*15; pos[i*3+2]=Math.sin(a)*d;
}
const geom = new THREE.BufferGeometry(); geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
galaxy.add(new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.2, transparent:true, opacity:0.6 })));

// Centro y Anillo
const core = new THREE.Mesh(new THREE.SphereGeometry(12,32,32), new THREE.MeshBasicMaterial({ color: 0x140018 }));
scene.add(core);
const ring = new THREE.Mesh(new THREE.RingGeometry(13, 15, 64), new THREE.MeshBasicMaterial({ color: 0xEAAEFF, side: THREE.DoubleSide, transparent:true, opacity:0.8 }));
ring.rotation.x = Math.PI/2; scene.add(ring);

function animate(){
    requestAnimationFrame(animate);
    galaxy.rotation.y += 0.001;
    controls.update();
    renderer.render(scene, camera);
} animate();

// Corazones
const fx = document.getElementById('fx'); const fctx = fx.getContext('2d');
function resFx(){ fx.width=window.innerWidth; fx.height=window.innerHeight; } resFx();
const hearts = [];
window.addEventListener('click', (e) => {
    for(let i=0; i<15; i++) hearts.push({x:e.clientX, y:e.clientY, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, l:1});
});
function loopFx(){
    fctx.clearRect(0,0,fx.width, fx.height);
    hearts.forEach((h,i) => {
        h.x+=h.vx; h.y+=h.vy; h.l-=0.02;
        fctx.globalAlpha = h.l; fctx.fillStyle = '#ff8ae5';
        fctx.beginPath(); fctx.arc(h.x, h.y, 5, 0, Math.PI*2); fctx.fill();
        if(h.l<=0) hearts.splice(i,1);
    });
    requestAnimationFrame(loopFx);
} loopFx();

} catch(e) { showError('Error: '+e.message); }
})();
</script>
</body>
</html>
